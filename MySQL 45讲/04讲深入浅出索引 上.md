# 深入浅出索引
> 索引的出现是为了提高数据查询的效率,类似书的目录一样

## InnoDB索引模型
- 在InnoDB中表都是根据**主键的顺序以索引的形式存放的**
- 同时这个索引是按照B+树的索引模型存储的
- InnoDB中每一个索引对应一颗B+书,同时一个表其实也是一个B+树
- 主键索引(聚簇索引)的叶子节点存储的是整行数据
- 非主键索引(二级索引)的叶子节点存储的是主键ID

![](http://img.jaken.top/image/20211127212351.png)


### 主键索引和普通索引的查询区别
#### 主键索引查询
- 直接通过ID来搜索这颗B+树
- 检索出来的结果就是数据行本身

#### 普通索引查询
- 首先根据索引搜索普通索引树
- 得到ID的值后遍历主键索引
- 即操作了树结构两次,这一过程称为回表

### 索引维护
- 每次插入新值的时候,都会对所有索引做维护
- 页分裂:如果某个数据页已满,根据B+树算法,需要分裂
	- 需要申请一个新的数据页
	- 挪动部分数据
	- 这一过程成为列分裂,对性能有所影响
	- 同时空间利用率也会减少
- 页合并:相邻两个页由于删除数据,利用率很低后,就会做合并

#### 是否使用自增主键
- 根据索引维护我们可能认为使用自增主键可以减少页分裂的过程
- 在Key-Value的场景下必然不需要使用自增主键
- 其实在实际业务中,为了减少回表操作我们依旧会根据雪花算法去生成主键
	- 其实这是减少回写操作准备的
	- 同时在分布式环境下,也减少唯一索引导致的西能你问题

**主键长度越小,普通索引的叶子节点越小,占用空间也就越小**